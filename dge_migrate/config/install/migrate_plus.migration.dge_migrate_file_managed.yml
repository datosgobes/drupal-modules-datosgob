id: dge_migrate_file_managed
label: Custom files migration from Drupal 7
migration_group: dge_migrate
dependencies:
  enforced:
    module:
      - dge_migrate
source:
  plugin: d7_file
  scheme: public
  constants:
    source_base_path: 'sites/default/files'             # used by d7_file module to replace uri source
    source_file_path: 'sites/default/files/files-d7'    # path from where the files are migrated
destination:
  plugin: entity:file
process:
  # To avoid overwriting the fid
  # fid: fid
  uid:
    plugin: migration_lookup
    migration: dge_migrate_users_roles
    no_stub: true
    source: uid
  filename: filename
  source_full_path:
    -
      plugin: concat
      delimiter: /
      source:
        - constants/source_file_path
        - filepath
    -
      plugin: urlencode
  uri:
    plugin: file_copy
    source:
      - '@source_full_path'
      - uri
  filemime: filemime
  # No need to migrate filesize, it is computed when file entities are saved.
  # filesize: filesize
  status: status
  created: timestamp
  changed: timestamp
migration_dependencies:
  required:
    - dge_migrate_users_roles
  optional: {  }